<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Home - BudgetWise</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
          font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        background: linear-gradient(135deg, #D8F3DC 0%, #D8F3DC 100%);
        background-attachment: fixed;
        min-height: 100vh;
        position: relative;
        color: #013220
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
             background-image: 
                radial-gradient(circle at 20% 50%, rgba(45, 106, 79, 0.08) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(64, 145, 108, 0.08) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .navbar {
            background: white;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid #f1f5f9;
        }

        .navbar-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo h1 {
             color: #013220;
    font-size: 24px;
    font-weight: 700;
    letter-spacing: -0.5px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .username {
            color: #64748b;
            font-weight: 500;
            font-size: 14px;
            padding: 8px 16px;
            background: #f8fafc;
            border-radius: 8px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #2D6A4F 0%, #40916C 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(45, 106, 79, 0.3);
        }

        .btn-primary:hover {
             transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(45, 106, 79, 0.4);
        }

        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
        }

        .btn-secondary:hover {
            background: #e2e8f0;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 40px;
            position: relative;
            z-index: 1;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-header h2 {
            font-size: 32px;
            color: #1e293b;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .page-header p {
            color: #64748b;
            font-size: 16px;
        }

        /* OCR Upload Section */
        .ocr-upload-section {
            margin-bottom: 32px;
            padding: 24px;
            background: linear-gradient(135deg, #2D6A4F 0%, #40916C 100%);
            border-radius: 16px;
            box-shadow: 0 8px 24px rgba(45, 106, 79, 0.3);
        }

        .ocr-upload-section h3 {
            color: white;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            font-size: 20px;
            font-weight: 700;
        }

        .upload-area {
            background: white;
            border-radius: 12px;
            padding: 24px;
            text-align: center;
            border: 3px dashed transparent;
            transition: all 0.3s ease;
        }

        .upload-area.drag-over {
            border-color: #28a745;
            background: #e8f5e9;
        }

        .upload-area button {
            margin: 8px;
        }

        #uploadStatus {
            margin-top: 16px;
            font-size: 14px;
            font-weight: 500;
            padding: 12px;
            border-radius: 8px;
            display: none;
        }

        #uploadStatus.success {
            display: block;
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        #uploadStatus.error {
            display: block;
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        #uploadStatus.processing {
            display: block;
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 3px solid rgba(12, 84, 96, 0.3);
            border-radius: 50%;
            border-top-color: #0c5460;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        #imagePreview {
            margin-top: 16px;
            display: none;
        }

        #previewImg {
            max-width: 300px;
            max-height: 300px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .ocr-upload-section > p {
            color: white;
            font-size: 13px;
            margin-top: 12px;
            opacity: 0.95;
        }

        /* Camera Modal */
        #cameraModal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.85);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        #cameraModal.active {
            display: flex;
        }

        #cameraModal > div {
            background: white;
            padding: 24px;
            border-radius: 16px;
            max-width: 90%;
            max-height: 90%;
            text-align: center;
        }

        #cameraModal h3 {
            margin-bottom: 16px;
            color: #1e293b;
        }

        #cameraStream {
            max-width: 100%;
            border-radius: 12px;
            display: block;
            margin-bottom: 16px;
        }

        #cameraModal button {
            margin: 8px;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .card {
            background: white;
            padding: 32px;
            border-radius: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid #f1f5f9;
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 28px rgba(0,0,0,0.08);
        }

        .card h2 {
             color: #013220;
    font-size: 20px;
    font-weight: 700;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
        }

        .card p {
            color: #64748b;
            margin-bottom: 24px;
            line-height: 1.6;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #475569;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.3px;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 14px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 14px;
            transition: all 0.2s ease;
            background: white;
            color: #1e293b;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group input::placeholder {
            color: #94a3b8;
        }

        .prediction-box {
            background: linear-gradient(135deg, #2D6A4F 0%, #40916C 100%);
    color: white;
    padding: 24px;
    border-radius: 12px;
    text-align: center;
    margin-top: 20px;
    box-shadow: 0 8px 24px rgba(45, 106, 79, 0.3);
        }

        .prediction-box h3 {
            font-size: 36px;
            margin-bottom: 8px;
            font-weight: 700;
        }

        .prediction-box p {
            color: rgba(255,255,255,0.95);
            font-size: 14px;
            margin: 0;
            font-weight: 500;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #667eea;
            font-weight: 500;
        }

        .forecast-item {
            background: #f8fafc;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 12px;
            border: 1px solid #e2e8f0;
            transition: all 0.2s ease;
        }

        .forecast-item:hover {
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .forecast-item h3 {
             color: #2D6A4F;
    margin-bottom: 16px;
    font-size: 18px;
    font-weight: 700;
        }

        .forecast-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 16px;
        }

        .forecast-stat {
            text-align: center;
        }

        .forecast-stat-label {
            color: #64748b;
            font-size: 12px;
            margin: 0 0 8px 0;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .forecast-stat-value {
            font-weight: 700;
            margin: 0;
            font-size: 18px;
        }

        .forecast-stat-value.expense {
            color: #ef4444;
        }

        .forecast-stat-value.income {
            color: #10b981;
        }

        .forecast-stat-value.savings {
            color: #2D6A4F;
        }

        .card-full {
            grid-column: 1 / -1;
        }

        .error-message {
            color: #ef4444;
            background: #fee2e2;
            padding: 12px 16px;
            border-radius: 8px;
            margin-top: 16px;
            font-size: 14px;
            border-left: 4px solid #ef4444;
        }

        body.dark-mode {
            background: #0f172a;
            color: #e2e8f0;
        }

        body.dark-mode .navbar {
            background: #1e293b;
            border-bottom: 1px solid #334155;
        }

        body.dark-mode .logo h1 {
            color: #f1f5f9;
        }

        body.dark-mode .card {
            background: #1e293b;
            border: 1px solid #334155;
            color: #f1f5f9;
        }

        body.dark-mode .card h2 {
            color: #f8fafc;
        }

        body.dark-mode .card p {
            color: #cbd5e1;
        }

        body.dark-mode .btn-secondary {
            background: #334155;
            color: #f1f5f9;
        }

        body.dark-mode .btn-secondary:hover {
            background: #475569;
        }

        body.dark-mode .forecast-item {
            background: #1e293b;
            border-color: #334155;
        }

        body.dark-mode .form-group input,
        body.dark-mode .form-group select {
            background: #0f172a;
            color: #f1f5f9;
            border-color: #334155;
        }

        body.dark-mode .upload-area {
            background: #1e293b;
        }

        body.dark-mode #cameraModal > div {
            background: #1e293b;
        }

        body.dark-mode #cameraModal h3 {
            color: #f8fafc;
        }

        @media (max-width: 1024px) {
            .cards-grid {
                grid-template-columns: 1fr;
            }

            .forecast-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            .navbar-content {
                padding: 16px 20px;
                flex-direction: column;
                gap: 16px;
            }

            .page-header h2 {
                font-size: 24px;
            }

            .user-info {
                width: 100%;
                justify-content: space-between;
            }
        }


        /* Success Notification */
.success-notification {
    background: linear-gradient(135deg, #15d193, #168f68);
    color: white;
    padding: 16px 20px;
    border-radius: 12px;
    margin-bottom: 20px;
    display: flex;
    align-items: center;
    gap: 16px;
    box-shadow: 0 8px 24px rgba(16, 185, 129, 0.3);
    animation: slideDown 0.5s ease-out;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.success-icon {
    font-size: 32px;
    flex-shrink: 0;
    animation: scaleIn 0.5s ease-out;
}

@keyframes scaleIn {
    0% {
        transform: scale(0);
    }
    50% {
        transform: scale(1.2);
    }
    100% {
        transform: scale(1);
    }
}

.success-text strong {
    display: block;
    font-size: 16px;
    margin-bottom: 4px;
}

.success-text p {
    font-size: 13px;
    margin: 0;
    opacity: 0.9;
}

.success-notification.show {
    display: flex;
}

.success-notification.hide {
    animation: slideUp 0.5s ease-out forwards;
}

@keyframes slideUp {
    from {
        opacity: 1;
        transform: translateY(0);
    }
    to {
        opacity: 0;
        transform: translateY(-20px);
    }
}


    </style>
</head>
<body>
    <div class="navbar">
        <div class="navbar-content">
            <div class="logo">
                <h1>üí∞ BudgetWise</h1>
            </div>
            <div class="user-info">
                <span class="username">Hello, {{ username }}!</span>
                <a href="/dashboard" class="btn btn-secondary">üìä Dashboard</a>
                <a href="/logout" class="btn btn-secondary">Logout</a>
                <button id="themeToggle" class="btn btn-secondary">üåô Dark Mode</button>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="page-header">
            <h2>Manage Your Finances</h2>
            <p>Add transactions and get AI-powered insights about your spending</p>
        </div>

        <!-- üì∏ OCR UPLOAD SECTION -->
        <div class="ocr-upload-section">
            <h3>üì∏ Upload Bill/Receipt (Auto-fill with AI)</h3>
            
            <div class="upload-area" id="uploadArea">
                <input type="file" id="billImageInput" accept="image/*" style="display: none;">
                
                <button type="button" onclick="document.getElementById('billImageInput').click()" class="btn btn-primary">
                    üìÅ Choose Image
                </button>
                
                <button type="button" onclick="openCamera()" class="btn btn-primary">
                    üì∑ Take Photo
                </button>
                
                <div id="uploadStatus"></div>
                
                <div id="imagePreview">
                    <img id="previewImg" alt="Bill preview">
                </div>
            </div>
            
            <p>üí° Upload any bill/receipt and AI will automatically extract transaction details!</p>
        </div>

        <!-- Camera Modal -->
        <div id="cameraModal">
            <div>
                <h3>üì∏ Take Photo of Bill</h3>
                <video id="cameraStream" autoplay playsinline></video>
                <canvas id="cameraCanvas" style="display: none;"></canvas>
                
                <div style="margin-top: 16px;">
                    <button onclick="capturePhoto()" class="btn btn-primary">
                        üì∏ Capture
                    </button>
                    <button onclick="closeCamera()" class="btn btn-secondary">
                        ‚ùå Cancel
                    </button>
                </div>
            </div>
        </div>

        <div class="cards-grid">
            <!-- Add Transaction Card -->
            <div class="card">
                <h2>‚ûï Add Transaction</h2>
                <form action="/add_transaction" method="POST" id="transactionForm">
                    <div id="successMessage" class="success-notification" style="display: none;">
        <div class="success-icon">‚úÖ</div>
        <div class="success-text">
            <strong>Transaction Added Successfully!</strong>
            <p>Your transaction has been recorded.</p>
        </div>
    </div>
                    <div class="form-group">
                        <label>Date</label>
                        <input type="date" name="date" id="date" required>
                    </div>
                    <div class="form-group">
                        <label>Type</label>
                        <select name="transaction_type" id="transaction_type" required>
                            <option value="Expense">Expense</option>
                            <option value="Income">Income</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Category</label>
                        <input type="text" name="category" id="category" placeholder="e.g., Food, Rent, Salary" required>
                    </div>
                    <div class="form-group">
                        <label>Amount (‚Çπ)</label>
                        <input type="number" name="amount" id="amount" step="0.01" placeholder="0.00" required>
                    </div>
                    <div class="form-group">
                        <label>Payment Mode</label>
                        <select name="payment_mode" id="payment_mode" required>
                            <option value="UPI">UPI</option>
                            <option value="Cash">Cash</option>
                            <option value="Credit Card">Credit Card</option>
                            <option value="Debit Card">Debit Card</option>
                            <option value="Bank Transfer">Bank Transfer</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Location (Optional)</label>
                        <input type="text" name="location" id="location" placeholder="City or place">
                    </div>
                    <div class="form-group">
                        <label>Notes (Optional)</label>
                        <input type="text" name="notes" id="notes" placeholder="Additional details">
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Add Transaction</button>
                </form>
            </div>

            <!-- Predict Monthly Expense Card -->
            <div class="card">
                <h2>üìä Predict Monthly Expense</h2>
                <p>Get AI-powered predictions for your expenses this month based on your spending patterns.</p>
                <button class="btn btn-primary" style="width: 100%;" onclick="predictExpense()">
                    Predict Expense
                </button>
                <div id="expense-loading" class="loading">‚è≥ Calculating...</div>
                <div id="expense-result"></div>
            </div>

            <!-- Predict Savings Card -->
            <div class="card">
                <h2>üí∞ Predict Monthly Savings</h2>
                <p>Find out how much you're likely to save this month based on your income and expense trends.</p>
                <button class="btn btn-primary" style="width: 100%;" onclick="predictSavings()">
                    Predict Savings
                </button>
                <div id="savings-loading" class="loading">‚è≥ Calculating...</div>
                <div id="savings-result"></div>
            </div>
        </div>

        <!-- Forecast Card (Full Width) -->
        <div class="card card-full">
            <h2>üîÆ 3-Month Forecast</h2>
            <p>See your predicted expenses, income, and savings for the next 3 months.</p>
            <button class="btn btn-primary" onclick="getForecast()">Generate Forecast</button>
            <div id="forecast-loading" class="loading">‚è≥ Generating forecast...</div>
            <div id="forecast-result"></div>
        </div>
    </div>

    <script>
        let cameraStream = null;

        // Set today's date as default
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('date').valueAsDate = new Date();

            // Check for success message
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('success') === 'true') {
        showSuccessMessage();
        
        // Remove success parameter from URL without reloading
        window.history.replaceState({}, document.title, window.location.pathname);
    }
        });

        function showSuccessMessage() {
    const successMsg = document.getElementById('successMessage');
    successMsg.style.display = 'flex';
    successMsg.classList.add('show');
    
    // Auto-hide after 4 seconds
    setTimeout(() => {
        successMsg.classList.add('hide');
        setTimeout(() => {
            successMsg.style.display = 'none';
            successMsg.classList.remove('show', 'hide');
        }, 500);
    }, 4000);
}

        // OCR: Handle file upload
        document.getElementById('billImageInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                showImagePreview(file);
                uploadBillImage(file);
            }
             const submitBtn = this.querySelector('button[type="submit"]');
    submitBtn.textContent = '‚è≥ Adding...';
    submitBtn.disabled = true;
        });

        // OCR: Drag and drop handlers
        const uploadArea = document.getElementById('uploadArea');

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('drag-over');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('drag-over');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
            
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                showImagePreview(file);
                uploadBillImage(file);
            } else {
                showStatus('Please drop an image file', 'error');
            }
        });

        function showImagePreview(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('previewImg').src = e.target.result;
                document.getElementById('imagePreview').style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

        function showStatus(message, type = 'processing') {
            const statusDiv = document.getElementById('uploadStatus');
            statusDiv.className = type;
            
            if (type === 'processing') {
                statusDiv.innerHTML = `<span class="loading-spinner"></span> ${message}`;
            } else {
                statusDiv.innerHTML = message;
            }
        }

        function uploadBillImage(file) {
            const formData = new FormData();
            formData.append('bill_image', file);
            
            showStatus('üîÑ Processing bill with OCR... Please wait', 'processing');
            
            fetch('/upload-bill', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showStatus(`‚úÖ ${data.message}`, 'success');
                    
                    // Auto-fill the transaction form
                    fillTransactionForm(data.data);
                    
                    // Scroll to form with highlight
                    highlightForm();
                } else {
                    showStatus(`‚ùå ${data.error}`, 'error');
                }
            })
            .catch(error => {
                showStatus(`‚ùå Upload failed: ${error.message}`, 'error');
                console.error('Upload error:', error);
            });
        }

        function fillTransactionForm(data) {
            // Fill in the extracted data
            if (data.date) document.getElementById('date').value = data.date;
            if (data.transaction_type) document.getElementById('transaction_type').value = data.transaction_type;
            if (data.category) document.getElementById('category').value = data.category;
            if (data.amount) document.getElementById('amount').value = data.amount;
            if (data.payment_mode) document.getElementById('payment_mode').value = data.payment_mode;
            if (data.location) document.getElementById('location').value = data.location;
            if (data.notes) document.getElementById('notes').value = data.notes;
        }

        function highlightForm() {
            const form = document.getElementById('transactionForm').closest('.card');
            form.scrollIntoView({ behavior: 'smooth', block: 'center' });
            
            // Add highlight effect
            form.style.border = '3px solid #28a745';
            form.style.boxShadow = '0 0 20px rgba(40, 167, 69, 0.3)';
            
            setTimeout(() => {
                form.style.border = '';
                form.style.boxShadow = '';
            }, 3000);
        }

        // Camera functions
        function openCamera() {
            const modal = document.getElementById('cameraModal');
            modal.classList.add('active');
            
            navigator.mediaDevices.getUserMedia({ 
                video: { 
                    facingMode: 'environment',
                    width: { ideal: 1920 },
                    height: { ideal: 1080 }
                } 
            })
            .then(stream => {
                cameraStream = stream;
                document.getElementById('cameraStream').srcObject = stream;
            })
            .catch(error => {
                alert('Camera access denied or not available: ' + error.message);
                closeCamera();
            });
        }

        function closeCamera() {
            if (cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                cameraStream = null;
            }
            document.getElementById('cameraModal').classList.remove('active');
        }

        function capturePhoto() {
            const video = document.getElementById('cameraStream');
            const canvas = document.getElementById('cameraCanvas');
            const context = canvas.getContext('2d');
            
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            context.drawImage(video, 0, 0);
            
            canvas.toBlob(function(blob) {
                const file = new File([blob], 'captured_bill_' + Date.now() + '.jpg', { type: 'image/jpeg' });
                
                closeCamera();
                showImagePreview(file);
                uploadBillImage(file);
            }, 'image/jpeg', 0.95);
        }

        function predictExpense() {
            const loading = document.getElementById('expense-loading');
            const result = document.getElementById('expense-result');
            
            loading.style.display = 'block';
            result.innerHTML = '';

            fetch('/predict/expense')
                .then(response => response.json())
                .then(data => {
                    loading.style.display = 'none';
                    if (data.error) {
                        result.innerHTML = `<div class="error-message">${data.error}</div>`;
                    } else {
                        result.innerHTML = `
                            <div class="prediction-box">
                                <h3>‚Çπ${data.predicted_expense.toLocaleString('en-IN')}</h3>
                                <p>Predicted Monthly Expense</p>
                            </div>
                        `;
                    }
                })
                .catch(error => {
                    loading.style.display = 'none';
                    result.innerHTML = `<div class="error-message">Error: ${error}</div>`;
                });
        }

        function predictSavings() {
            const loading = document.getElementById('savings-loading');
            const result = document.getElementById('savings-result');
            
            loading.style.display = 'block';
            result.innerHTML = '';

            fetch('/predict/savings')
                .then(response => response.json())
                .then(data => {
                    loading.style.display = 'none';
                    if (data.error) {
                        result.innerHTML = `<div class="error-message">${data.error}</div>`;
                    } else {
                        result.innerHTML = `
                            <div class="prediction-box">
                                <h3>‚Çπ${data.predicted_savings.toLocaleString('en-IN')}</h3>
                                <p>Predicted Monthly Savings</p>
                            </div>
                        `;
                    }
                })
                .catch(error => {
                    loading.style.display = 'none';
                    result.innerHTML = `<div class="error-message">Error: ${error}</div>`;
                });
        }

        function getForecast() {
            const loading = document.getElementById('forecast-loading');
            const result = document.getElementById('forecast-result');
            
            loading.style.display = 'block';
            result.innerHTML = '';

            fetch('/predict/forecast')
                .then(response => response.json())
                .then(data => {
                    loading.style.display = 'none';
                    if (data.error) {
                        result.innerHTML = `<div class="error-message">${data.error}</div>`;
                    } else if (data.forecast && data.forecast.length > 0) {
                        let html = '<div style="margin-top: 24px;">';
                        data.forecast.forEach(item => {
                            html += `
                                <div class="forecast-item">
                                    <h3>${item.month}</h3>
                                    <div class="forecast-grid">
                                        <div class="forecast-stat">
                                            <p class="forecast-stat-label">Expense</p>
                                            <p class="forecast-stat-value expense">‚Çπ${item.predicted_expense.toLocaleString('en-IN')}</p>
                                        </div>
                                        <div class="forecast-stat">
                                            <p class="forecast-stat-label">Income</p>
                                            <p class="forecast-stat-value income">‚Çπ${item.predicted_income.toLocaleString('en-IN')}</p>
                                        </div>
                                        <div class="forecast-stat">
                                            <p class="forecast-stat-label">Savings</p>
                                            <p class="forecast-stat-value savings">‚Çπ${item.predicted_savings.toLocaleString('en-IN')}</p>
                                        </div>
                                    </div>
                                </div>
                            `;
                        });
                        html += '</div>';
                        result.innerHTML = html;
                    }
                })
                .catch(error => {
                    loading.style.display = 'none';
                    result.innerHTML = `<div class="error-message">Error: ${error}</div>`;
                });
        }

        // Dark mode toggle
        document.getElementById('themeToggle').addEventListener('click', function() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            this.textContent = isDark ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
        });
    </script>
</body>
</html>